<!DOCTYPE html>
<html>

<head>
    <title>domino-clj</title>
    <meta charset="utf-8">
    <!-- KLIPSE ASSETS -->
    <link rel="stylesheet" type="text/css" href="codemirror.css">
    <script>
        window.klipse_settings = {
            selector: '.lang-eval-clojure', // css selector for the html elements you want to klipsify
        };
    </script>
    <!-- END KLIPSE ASSETS -->

    <link rel="stylesheet" type="text/css" href="style.css">
    <link rel="stylesheet" type="text/css" href="highlight.pack.css">

</head>

<body>
    <h1>Example of using Domino with Reagent</h1><p><pre><code class="language-eval-clojure" data-external-libs="https://raw.githubusercontent.com/domino-clj/domino/master/src"> (require '[domino.core :as core]) (require '[reagent.core :as reagent]) (require '[cljs.pprint :refer [pprint]])</p><p>(def ctx   (reagent/atom<pre><code>&#40;let &#91;model {:model
             &#91;&#91;:user {}
               &#91;:first-name {:id :fname}&#93;
               &#91;:last-name {:id :lname}&#93;
               &#91;:full-name {:id :full-name}&#93;
               &#91;:weight {:id :weight}
                &#91;:lb {:id :lb}&#93;
                &#91;:kg {:id :kg}&#93;&#93;&#93;
              &#91;:physician {}
               &#91;:first-name {:id :physician-fname}&#93;&#93;&#93;
             :effects
             &#91;{:inputs  &#91;:full-name&#93;
               :handler &#40;fn &#91;&#95; &#91;full-name&#93;&#93;
                          &#40;when &#40;= &quot;Bobberton, Bob&quot; full-name&#41;
                            &#40;js/alert &quot;launching missiles!&quot;&#41;&#41;&#41;}&#93;
             :events
             &#91;{:inputs  &#91;:fname :lname&#93;
               :outputs &#91;:full-name&#93;
               :handler &#40;fn &#91;&#95; &#91;fname lname&#93; &#95;&#93;
                          &#91;&#40;or &#40;when &#40;and fname lname&#41; &#40;str lname &quot;, &quot; fname&#41;&#41; fname lname&#41;&#93;&#41;}
              {:inputs  &#91;:kg&#93;
               :outputs &#91;:lb&#93;
               :handler &#40;fn &#91;&#95; &#91;kg&#93; &#95;&#93;
                          &#91;&#40;&#42; kg 2.20462&#41;&#93;&#41;}
              {:inputs  &#91;:lb&#93;
               :outputs &#91;:kg&#93;
               :handler &#40;fn &#91;&#95; &#91;lb&#93; &#95;&#93;
                          &#91;&#40;/ lb 2.20462&#41;&#93;&#41;}&#93;}&#93;
  &#40;core/initialize! model {}&#41;&#41;&#41;&#41; </code></pre>(defn transact [path value]   (swap! ctx core/transact [[path value]]))</p><p>(defn db-value [path]   (get-in @ctx (into [::core/db] path)))</p><p>(defn target-value [e]   (.. e -target -value))</p><p>(defn state-atom [path]   (let [state (reagent/atom nil)]<pre><code>&#40;add-watch ctx path
           &#40;fn &#91;path &#95; old-state new-state&#93;
             &#40;let &#91;ctx-path &#40;into &#91;::core/db&#93; path&#41;
                   old-value &#40;get-in old-state ctx-path&#41;
                   new-value &#40;get-in new-state ctx-path&#41;&#93;
               &#40;when &#40;not= old-value new-value&#41;
                 &#40;reset! state new-value&#41;&#41;&#41;&#41;&#41;
state&#41;&#41; </code></pre></p><p> (defn input [label path & [fmt]]    (let [local-state (state-atom path)<pre><code>     save-value  #&#40;reset! local-state &#40;if fmt &#40;fmt &#40;target-value %&#41;&#41; &#40;target-value %&#41;&#41;&#41;&#93;
 &#40;fn &#91;&#93;
   &#91;:div.field.is-horizontal
    &#91;:label.field-label.is-normal label &quot; &quot;&#93;
    &#91;:div.field-body&gt;input.input
     {:value     @local-state
      :on-change save-value
      :on-blur   #&#40;transact path @local-state&#41;}&#93;&#93;&#41;&#41;&#41; </code></pre>(defn home-page []   [:div    [input "First name" [:user :first-name]]    [input "Last name" [:user :last-name]]    [input "Weight (kg)" [:user :weight :kg] (fnil js/parseFloat 0)]    [input "Weight (lb)" [:user :weight :lb] (fnil js/parseFloat 0)]    [:label "Full name " (db-value [:user :full-name])]    [:hr]    [:h4 "DB state"]    [:pre (with-out-str (pprint (:domino.core/db @ctx)))]])</p><p>(reagent/render-component [home-page] js/klipse-container) </code></pre></p>

    <script src="highlight.pack.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', (event) => {
                document.querySelectorAll('pre code.clojure').forEach((block) => {
                    hljs.highlightBlock(block);
                });
            });
    </script>
    <script src="https://storage.googleapis.com/app.klipse.tech/plugin/js/klipse_plugin.js"></script>
</body>

</html>
